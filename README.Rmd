---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
    collapse = TRUE,
    comment = "#>",
    dev = "png",
    dev.args = list(png = list(type = "cairo")),
    fig.path = "man/figures/README-",
    out.width = "100%"
)
```

# GO-a-GO

<!-- badges: start -->
<!-- badges: end -->

GO-a-GO annotates Gene Ontology terms that are enriched in a given
set of gene pairs. The enrichment is calculated from a permutation test for
overrepresentation of gene pairs that are associated with a shared term.
Such gene pairs are counted for the original set of gene pairs and compared
against randomized sets in which the structure of the pairs is preserved,
but the gene identities (including the associated terms) are permuted.

## Installation

You can install the development version of GO-a-GO from [GitHub](https://github.com/) with:

```{r eval=FALSE}
# install.packages("devtools")
devtools::install_github("ajank/GOaGO")
```

## Example

Let us run GO-a-GO on a set of gene pairs associated with chromatin loops
identified in human cell line GM12878. We can inspect a few rows of the dataset:

```{r dataset}
library(GOaGO)

data("genePairsGM12878")
head(genePairsGM12878)
```

The column names ending with `1` and `2` refer to the first and second loop
anchors, respectively. The essential columns are: `geneID1` and `geneID2` (gene
identifiers from a database of choice) and `loopID` (identifier of a chromatin
loop). As some loop anchors overlapped multiple Transcription Start Sites,
possibly of many genes, for these loops the dataset contains all combinations.

When running GO-a-GO, we should specify that gene identifiers are from the
Entrez database, and use the Bioconductor `org.Hs.eg.db` package as the source
of Gene Ontology annotations for human genes, taking all three subontologies
(Biological Process, Molecular Function, and Cellular Component). We will run
the default 10,000 permutations, and also use the default *p*-value cutoff of
0.05 with Benjamini-Hochberg correction:

```{r example, message=FALSE}
library(org.Hs.eg.db)

# set the number of CPU threads to use
library(BiocParallel)
options(MulticoreParam = MulticoreParam(workers = 2))

goago <- GOaGO(genePairsGM12878,
    keyType = "ENTREZID", OrgDb = org.Hs.eg.db, ont = "ALL"
)
```

We can inspect the enriched GO terms:

```{r result}
head(as.data.frame(goago))
```

Note that some of the *p*-values have the value of zero, which means that for
all the randomizations fewer gene pairs were associated with a given term than
in the input dataset.

We can plot the enriched GO terms as a dotplot. The X-axis shows the fold
enrichment of the fraction of gene pairs sharing the given term, calculated as
a quotient of `PairRatio` (the fraction in the input gene pairs) and `BgRatio`
(the fraction in permuted ones). Point size indicates the number of input gene
pairs sharing the given term, and point color -- the adjusted *p*-value:

```{r dotplot}
DotPlot(goago)
```

Note that by default only the terms associated with at least 5 gene pairs are
shown; you can change this by setting `minTermPairs` to any other value.

We can also see the sampling distributions of numbers of gene pairs sharing each
GO term, obtained for the randomized gene pairs. From these distributions,
empirical *p*-values were calculated:

```{r ridgeplot}
RidgePlot(goago)
```
